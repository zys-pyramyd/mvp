<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pyramyd Agent Demo - Staging Environment</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .demo-watermark {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, #f59e0b, #d97706);
            color: white;
            text-align: center;
            padding: 8px;
            font-weight: 600;
            font-size: 14px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .demo-container {
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <!-- Demo Environment Watermark -->
    <div class="demo-watermark">
        üéØ PYRAMYD AGENT DEMO - STAGING ENVIRONMENT - NOT FOR PRODUCTION USE
    </div>

    <div id="demo-root" class="demo-container"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Demo Storage Manager
        const DemoStorage = {
            keys: {
                USER: 'pyramyd_demo_user',
                FARMERS: 'pyramyd_demo_farmers', 
                PRODUCTS: 'pyramyd_demo_products',
                ORDERS: 'pyramyd_demo_orders',
                KYC: 'pyramyd_demo_kyc'
            },

            init() {
                // Initialize demo user
                const demoUser = {
                    id: 'demo_agent_001',
                    username: 'demo_agent',
                    first_name: 'Demo',
                    last_name: 'Agent',
                    email: 'demo.agent@pyramyd.com',
                    phone: '+234 800 000 0001',
                    role: 'agent',
                    kyc_status: 'not_started',
                    business_info: {
                        business_name: 'Demo Agricultural Solutions',
                        business_address: 'Lagos, Nigeria'
                    }
                };

                const demoFarmers = [
                    {
                        id: 'farmer_001',
                        name: 'Adebayo Ogundimu',
                        phone: '+234 800 111 0001',
                        location: 'Ogun State, Nigeria',
                        crops: ['Rice', 'Yam', 'Cassava'],
                        farm_size: '5 hectares'
                    },
                    {
                        id: 'farmer_002',
                        name: 'Fatima Aliyu', 
                        phone: '+234 800 111 0002',
                        location: 'Kaduna State, Nigeria',
                        crops: ['Maize', 'Beans', 'Millet'],
                        farm_size: '3 hectares'
                    }
                ];

                const demoProducts = [
                    {
                        id: 'product_001',
                        title: 'Premium Local Rice',
                        price: 800,
                        unit: 'kg',
                        quantity: 500,
                        farmer: 'Adebayo Ogundimu',
                        location: 'Ogun State'
                    },
                    {
                        id: 'product_002', 
                        title: 'Fresh White Yam',
                        price: 1200,
                        unit: 'tuber',
                        quantity: 200,
                        farmer: 'Adebayo Ogundimu',
                        location: 'Ogun State'
                    }
                ];

                const demoOrders = [
                    {
                        id: 'order_001',
                        product: 'Premium Local Rice',
                        buyer: 'Lagos Restaurant Chain',
                        quantity: 50,
                        total: 42500,
                        status: 'delivered',
                        date: '2024-10-05'
                    }
                ];

                localStorage.setItem(this.keys.USER, JSON.stringify(demoUser));
                localStorage.setItem(this.keys.FARMERS, JSON.stringify(demoFarmers));
                localStorage.setItem(this.keys.PRODUCTS, JSON.stringify(demoProducts));
                localStorage.setItem(this.keys.ORDERS, JSON.stringify(demoOrders));
            },

            get(key) {
                const data = localStorage.getItem(this.keys[key]);
                return data ? JSON.parse(data) : null;
            },

            set(key, value) {
                localStorage.setItem(this.keys[key], JSON.stringify(value));
            },

            add(key, item) {
                const items = this.get(key) || [];
                item.id = `${key.toLowerCase()}_${Date.now()}`;
                items.push(item);
                this.set(key, items);
                return item;
            }
        };

        // KYC Submission Component
        const KYCSubmission = ({ onComplete }) => {
            const [step, setStep] = useState(1);
            const [loading, setLoading] = useState(false);
            const [formData, setFormData] = useState({
                business_name: 'Demo Agricultural Solutions',
                registration_number: 'RC-DEMO-001',
                tin_number: 'TIN-DEMO-001'
            });

            const handleSubmitKYC = async () => {
                setLoading(true);
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const user = DemoStorage.get('USER');
                user.kyc_status = 'approved';
                DemoStorage.set('USER', user);
                
                setLoading(false);
                onComplete();
            };

            if (step === 1) {
                return (
                    <div className="max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-lg">
                        <h2 className="text-2xl font-bold text-center mb-6">Agent KYC Submission</h2>
                        
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium mb-1">Business Name</label>
                                <input
                                    type="text"
                                    value={formData.business_name}
                                    onChange={(e) => setFormData({...formData, business_name: e.target.value})}
                                    className="w-full px-3 py-2 border rounded-lg"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium mb-1">Registration Number</label>
                                <input
                                    type="text"
                                    value={formData.registration_number}
                                    onChange={(e) => setFormData({...formData, registration_number: e.target.value})}
                                    className="w-full px-3 py-2 border rounded-lg"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium mb-1">TIN Number</label>
                                <input
                                    type="text"
                                    value={formData.tin_number}
                                    onChange={(e) => setFormData({...formData, tin_number: e.target.value})}
                                    className="w-full px-3 py-2 border rounded-lg"
                                />
                            </div>
                        </div>

                        <button
                            onClick={() => setStep(2)}
                            className="w-full mt-6 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700"
                        >
                            Next: Upload Documents
                        </button>
                    </div>
                );
            }

            if (step === 2) {
                return (
                    <div className="max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-lg">
                        <h2 className="text-2xl font-bold text-center mb-6">Document Upload</h2>
                        
                        <div className="space-y-4">
                            {['Certificate of Incorporation', 'TIN Certificate', 'Business License'].map((doc) => (
                                <div key={doc} className="border rounded-lg p-4">
                                    <h4 className="font-medium">{doc}</h4>
                                    <button
                                        onClick={() => {
                                            setTimeout(() => alert(`${doc} uploaded successfully!`), 1000);
                                        }}
                                        className="mt-2 px-3 py-1 bg-blue-600 text-white rounded text-sm"
                                    >
                                        Upload Document
                                    </button>
                                </div>
                            ))}
                        </div>

                        <div className="flex space-x-4 mt-6">
                            <button
                                onClick={() => setStep(1)}
                                className="flex-1 px-4 py-2 border rounded-lg"
                            >
                                Back
                            </button>
                            <button
                                onClick={handleSubmitKYC}
                                disabled={loading}
                                className="flex-1 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50"
                            >
                                {loading ? 'Processing...' : 'Submit KYC'}
                            </button>
                        </div>
                    </div>
                );
            }
        };

        // Agent Dashboard Component
        const AgentDashboard = () => {
            const [activeTab, setActiveTab] = useState('overview');
            const [farmers, setFarmers] = useState([]);
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [showAddFarmer, setShowAddFarmer] = useState(false);
            const [showAddProduct, setShowAddProduct] = useState(false);

            useEffect(() => {
                setFarmers(DemoStorage.get('FARMERS') || []);
                setProducts(DemoStorage.get('PRODUCTS') || []);
                setOrders(DemoStorage.get('ORDERS') || []);
            }, []);

            const AddFarmerModal = ({ onClose }) => {
                const [farmerData, setFarmerData] = useState({
                    name: '',
                    phone: '',
                    location: '',
                    crops: '',
                    farm_size: ''
                });

                const handleSubmit = (e) => {
                    e.preventDefault();
                    const newFarmer = {
                        ...farmerData,
                        crops: farmerData.crops.split(',').map(c => c.trim())
                    };
                    const addedFarmer = DemoStorage.add('FARMERS', newFarmer);
                    setFarmers(prev => [...prev, addedFarmer]);
                    onClose();
                };

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div className="bg-white rounded-lg p-6 w-full max-w-md">
                            <h3 className="text-lg font-semibold mb-4">Add New Farmer</h3>
                            
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <input
                                    type="text"
                                    placeholder="Farmer Name"
                                    value={farmerData.name}
                                    onChange={(e) => setFarmerData({...farmerData, name: e.target.value})}
                                    className="w-full px-3 py-2 border rounded-lg"
                                    required
                                />
                                <input
                                    type="tel"
                                    placeholder="Phone Number"
                                    value={farmerData.phone}
                                    onChange={(e) => setFarmerData({...farmerData, phone: e.target.value})}
                                    className="w-full px-3 py-2 border rounded-lg"
                                    required
                                />
                                <input
                                    type="text"
                                    placeholder="Location"
                                    value={farmerData.location}
                                    onChange={(e) => setFarmerData({...farmerData, location: e.target.value})}
                                    className="w-full px-3 py-2 border rounded-lg"
                                    required
                                />
                                <input
                                    type="text"
                                    placeholder="Crops (comma separated)"
                                    value={farmerData.crops}
                                    onChange={(e) => setFarmerData({...farmerData, crops: e.target.value})}
                                    className="w-full px-3 py-2 border rounded-lg"
                                    required
                                />
                                <input
                                    type="text"
                                    placeholder="Farm Size"
                                    value={farmerData.farm_size}
                                    onChange={(e) => setFarmerData({...farmerData, farm_size: e.target.value})}
                                    className="w-full px-3 py-2 border rounded-lg"
                                    required
                                />
                                
                                <div className="flex space-x-3 pt-4">
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className="flex-1 px-4 py-2 border rounded-lg"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        type="submit"
                                        className="flex-1 px-4 py-2 bg-emerald-600 text-white rounded-lg"
                                    >
                                        Add Farmer
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            const AddProductModal = ({ onClose }) => {
                const [productData, setProductData] = useState({
                    title: '',
                    price: '',
                    unit: 'kg',
                    quantity: '',
                    farmer: farmers[0]?.name || '',
                    location: farmers[0]?.location || ''
                });

                const handleSubmit = (e) => {
                    e.preventDefault();
                    const newProduct = {
                        ...productData,
                        price: parseFloat(productData.price),
                        quantity: parseInt(productData.quantity)
                    };
                    const addedProduct = DemoStorage.add('PRODUCTS', newProduct);
                    setProducts(prev => [...prev, addedProduct]);
                    onClose();
                };

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div className="bg-white rounded-lg p-6 w-full max-w-md">
                            <h3 className="text-lg font-semibold mb-4">Add New Product</h3>
                            
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <input
                                    type="text"
                                    placeholder="Product Title"
                                    value={productData.title}
                                    onChange={(e) => setProductData({...productData, title: e.target.value})}
                                    className="w-full px-3 py-2 border rounded-lg"
                                    required
                                />
                                <input
                                    type="number"
                                    placeholder="Price per Unit"
                                    value={productData.price}
                                    onChange={(e) => setProductData({...productData, price: e.target.value})}
                                    className="w-full px-3 py-2 border rounded-lg"
                                    required
                                />
                                <select
                                    value={productData.unit}
                                    onChange={(e) => setProductData({...productData, unit: e.target.value})}
                                    className="w-full px-3 py-2 border rounded-lg"
                                >
                                    <option value="kg">Kilogram</option>
                                    <option value="tuber">Tuber</option>
                                    <option value="bag">Bag</option>
                                </select>
                                <input
                                    type="number"
                                    placeholder="Quantity Available"
                                    value={productData.quantity}
                                    onChange={(e) => setProductData({...productData, quantity: e.target.value})}
                                    className="w-full px-3 py-2 border rounded-lg"
                                    required
                                />
                                <select
                                    value={productData.farmer}
                                    onChange={(e) => {
                                        const farmer = farmers.find(f => f.name === e.target.value);
                                        setProductData({
                                            ...productData, 
                                            farmer: e.target.value,
                                            location: farmer?.location || ''
                                        });
                                    }}
                                    className="w-full px-3 py-2 border rounded-lg"
                                >
                                    {farmers.map(farmer => (
                                        <option key={farmer.id} value={farmer.name}>{farmer.name}</option>
                                    ))}
                                </select>
                                
                                <div className="flex space-x-3 pt-4">
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className="flex-1 px-4 py-2 border rounded-lg"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        type="submit"
                                        className="flex-1 px-4 py-2 bg-emerald-600 text-white rounded-lg"
                                    >
                                        Add Product
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            const renderOverview = () => (
                <div className="space-y-6">
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div className="bg-blue-500 text-white p-4 rounded-lg">
                            <h3 className="text-2xl font-bold">{farmers.length}</h3>
                            <p className="text-blue-100">Farmers</p>
                        </div>
                        <div className="bg-green-500 text-white p-4 rounded-lg">
                            <h3 className="text-2xl font-bold">{products.length}</h3>
                            <p className="text-green-100">Products</p>
                        </div>
                        <div className="bg-purple-500 text-white p-4 rounded-lg">
                            <h3 className="text-2xl font-bold">{orders.length}</h3>
                            <p className="text-purple-100">Orders</p>
                        </div>
                        <div className="bg-yellow-500 text-white p-4 rounded-lg">
                            <h3 className="text-2xl font-bold">‚Ç¶{orders.reduce((sum, order) => sum + order.total, 0).toLocaleString()}</h3>
                            <p className="text-yellow-100">Revenue</p>
                        </div>
                    </div>

                    <div className="bg-white p-6 rounded-lg shadow">
                        <h3 className="text-lg font-semibold mb-4">Recent Activity</h3>
                        <div className="space-y-3">
                            {orders.slice(0, 3).map(order => (
                                <div key={order.id} className="flex justify-between items-center p-3 bg-gray-50 rounded">
                                    <div>
                                        <p className="font-medium">{order.product}</p>
                                        <p className="text-sm text-gray-600">Order from {order.buyer}</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="font-medium">‚Ç¶{order.total.toLocaleString()}</p>
                                        <span className="text-xs px-2 py-1 bg-green-100 text-green-600 rounded">{order.status}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );

            const renderFarmers = () => (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h3 className="text-lg font-semibold">Farmers Network</h3>
                        <button
                            onClick={() => setShowAddFarmer(true)}
                            className="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700"
                        >
                            + Add Farmer
                        </button>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {farmers.map(farmer => (
                            <div key={farmer.id} className="bg-white p-4 rounded-lg shadow border">
                                <h4 className="font-medium text-gray-900">{farmer.name}</h4>
                                <p className="text-sm text-gray-600">{farmer.phone}</p>
                                <p className="text-sm text-gray-600">üìç {farmer.location}</p>
                                <p className="text-sm text-gray-600">üè° {farmer.farm_size}</p>
                                <div className="mt-2">
                                    <p className="text-xs text-gray-500">Crops:</p>
                                    <div className="flex flex-wrap gap-1 mt-1">
                                        {farmer.crops.map((crop, index) => (
                                            <span key={index} className="text-xs bg-green-100 text-green-600 px-2 py-1 rounded">
                                                {crop}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            const renderProducts = () => (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h3 className="text-lg font-semibold">Products Management</h3>
                        <button
                            onClick={() => setShowAddProduct(true)}
                            className="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700"
                        >
                            + Add Product
                        </button>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {products.map(product => (
                            <div key={product.id} className="bg-white p-4 rounded-lg shadow border">
                                <h4 className="font-medium text-gray-900">{product.title}</h4>
                                <p className="text-lg font-semibold text-emerald-600">‚Ç¶{product.price}/{product.unit}</p>
                                <p className="text-sm text-gray-600">Available: {product.quantity} {product.unit}</p>
                                <p className="text-sm text-gray-600">Farmer: {product.farmer}</p>
                                <p className="text-sm text-gray-600">üìç {product.location}</p>
                            </div>
                        ))}
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-100">
                    <div className="bg-white shadow">
                        <div className="max-w-7xl mx-auto px-4">
                            <div className="flex items-center justify-between h-16">
                                <h1 className="text-xl font-semibold">Agent Dashboard</h1>
                                <span className="bg-orange-100 text-orange-600 px-3 py-1 rounded text-sm font-medium">
                                    DEMO MODE
                                </span>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white border-b">
                        <div className="max-w-7xl mx-auto px-4">
                            <nav className="flex space-x-8">
                                {[
                                    { id: 'overview', label: 'Overview' },
                                    { id: 'farmers', label: 'Farmers' },
                                    { id: 'products', label: 'Products' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`py-4 px-1 border-b-2 font-medium text-sm ${
                                            activeTab === tab.id
                                                ? 'border-emerald-500 text-emerald-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700'
                                        }`}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                            </nav>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 py-8">
                        {activeTab === 'overview' && renderOverview()}
                        {activeTab === 'farmers' && renderFarmers()}
                        {activeTab === 'products' && renderProducts()}
                    </div>

                    {showAddFarmer && <AddFarmerModal onClose={() => setShowAddFarmer(false)} />}
                    {showAddProduct && <AddProductModal onClose={() => setShowAddProduct(false)} />}
                </div>
            );
        };

        // Main Demo App
        const DemoApp = () => {
            const [currentStep, setCurrentStep] = useState('welcome');
            const [user, setUser] = useState(null);

            useEffect(() => {
                DemoStorage.init();
                const demoUser = DemoStorage.get('USER');
                setUser(demoUser);
                
                if (demoUser?.kyc_status === 'approved') {
                    setCurrentStep('dashboard');
                }
            }, []);

            if (currentStep === 'welcome') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-emerald-50 to-blue-50 flex items-center justify-center">
                        <div className="max-w-2xl mx-auto text-center p-8">
                            <h1 className="text-4xl font-bold text-gray-900 mb-4">
                                üéØ Pyramyd Agent Demo
                            </h1>
                            <p className="text-xl text-gray-600 mb-8">
                                Experience the complete agent onboarding workflow
                            </p>
                            
                            <div className="bg-white rounded-lg shadow-lg p-6 mb-8">
                                <h2 className="text-xl font-semibold mb-4">Demo Features</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">
                                    <div className="space-y-2">
                                        <div className="flex items-center space-x-2">
                                            <span className="text-green-500">‚úì</span>
                                            <span>Instant KYC Approval</span>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <span className="text-green-500">‚úì</span>
                                            <span>Farmer Network Management</span>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <span className="text-green-500">‚úì</span>
                                            <span>Product Publishing</span>
                                        </div>
                                    </div>
                                    <div className="space-y-2">
                                        <div className="flex items-center space-x-2">
                                            <span className="text-green-500">‚úì</span>
                                            <span>Order Management</span>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <span className="text-green-500">‚úì</span>
                                            <span>Revenue Analytics</span>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <span className="text-green-500">‚úì</span>
                                            <span>Local Storage Persistence</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button
                                onClick={() => setCurrentStep('kyc')}
                                className="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 px-8 rounded-lg text-lg shadow-lg transform hover:scale-105 transition-all"
                            >
                                Start Agent Demo ‚Üí
                            </button>

                            <p className="text-sm text-gray-500 mt-4">
                                This is a staging environment. All data is stored locally and not connected to production systems.
                            </p>
                        </div>
                    </div>
                );
            }

            if (currentStep === 'kyc') {
                return (
                    <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4">
                        <KYCSubmission onComplete={() => setCurrentStep('dashboard')} />
                    </div>
                );
            }

            if (currentStep === 'dashboard') {
                return <AgentDashboard />;
            }
        };

        ReactDOM.render(<DemoApp />, document.getElementById('demo-root'));
    </script>
</body>
</html>